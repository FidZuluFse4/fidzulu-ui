<div class="product-grid-container">
  <mat-card
    class="product-card"
    *ngFor="let product of products; trackBy: trackByProductId"
    (click)="goToProductDetails(product.p_id)"
  >
    <div class="card-image-container">
      <img
        mat-card-image
        [src]="product.p_img_url"
        [alt]="product.p_name"
        [title]="product.p_name"
      />
      <button
        class="wishlist-heart"
        (click)="$event.stopPropagation(); addToWishlist(product)"
        style="
          position: absolute;
          top: 10px;
          right: 10px;
          background: rgba(255, 255, 255, 0.7);
          border: none;
          border-radius: 50%;
          padding: 6px;
          cursor: pointer;
          z-index: 3;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <mat-icon style="font-size: 28px; color: red">
          {{ wishlistIds.has(product.p_id) ? "favorite" : "favorite_border" }}
        </mat-icon>
      </button>
    </div>

    <mat-card-content>
      <div class="brand-name">{{ product.p_subtype }}</div>
      <div class="product-name">{{ product.p_name }}</div>
      <div class="product-price">
        ₹{{ product.p_price.toLocaleString("en-IN") }}
      </div>
    </mat-card-content>

    <mat-card-actions (click)="$event.stopPropagation()">
      <!-- Show Add to Cart only if quantity is 0 -->
      <button
        mat-flat-button
        color="primary"
        class="add-to-cart-btn"
        *ngIf="!getQuantity(product)"
        (click)="addToCart(product)"
      >
        <mat-icon>add_shopping_cart</mat-icon>
        Add to Cart
      </button>

      <!-- Show quantity selector if product added -->
      <div class="qty-selector" *ngIf="getQuantity(product)">
        <button mat-mini-button (click)="decreaseQuantity(product)">−</button>
        <input readonly [value]="getQuantity(product)" />
        <button mat-mini-button (click)="increaseQuantity(product)">+</button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>
